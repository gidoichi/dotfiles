#!/bin/sh
# -*- mode:shell-script -*-


######################################################################
# Variable Settings
######################################################################

LINE_SELECTOR="${LINE_SELECTOR:-fzf}"
Homedir="$(d=${0%/*}/; [ "_$d" = "_$0/" ] && d='./'; cd "$d."; pwd)"


######################################################################
# Validation
######################################################################

set -u
: "${LINE_SELECTOR}"


######################################################################
# Main
######################################################################

if [ "${LINE_SELECTOR}" = "${0##*/}" ]; then
    export PATH=$(rmpath "${Homedir}")
fi

if [ ! -p '/dev/stdin' ] && [ -z "${FZF_DEFAULT_COMMAND:-}" ]; then
    find . \( ! -regex '.*/\..*' \) -type f
elif [ ! -p '/dev/stdin' ]; then
    "${FZF_DEFAULT_COMMAND}"
else
    cat
fi |
    if [ "${LINE_SELECTOR}" = 'fzf' ]; then
        "${LINE_SELECTOR}" "$@"
    else
        "${LINE_SELECTOR}"
    fi
